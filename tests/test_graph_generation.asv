clear;
close all;
filename = 'maps/test_vide.png';
global map w h
[map,w,h] = getImage(filename);
global list_x list_y
[list_y,list_x] = find(map);
global n
n = size(list_x);
n = n(1);
global L  %m
global density %pix/m
density = 50; 
global seg_sampling conf_sampling
seg_sampling = 20;
conf_sampling = 5;
L = [0.4,0.4,0.4,0.4];
global alpha
alpha = [3 1.5 1.2 1.0 1.0];

start = [140/density,295/density,-pi/2,0,0,pi/4]; 

goal = [75/density,90/density,-pi/2,0,0,0];


qSet = createConfigurationArray(100);
nb_voisin = 10;

graph = createConfigurationGraph(qSet,nb_voisin,@distance,@delta,@collision);

n_node = size(qSet,1);


[wasAdded_start,qSet,graph] = addConfiguration(start , qSet , graph ,nb_voisin , @delta , @collision , @distance);
[wasAdded_goal,qSet,graph] = addConfiguration(goal , qSet , graph ,nb_voisin , @delta , @collision , @distance);
wasAdded_start
wasAdded_goal


ax = show_sparse(map);

for i=1:n_node
    plot_robot(qSet(i,:)',L,ax);
end
plot_robot(start',L,ax,"b");
plot_robot(goal',L,ax,"k");

alpha = alpha./alpha(1);

[path,cost,openSet,closedSet] = astar( n_node+1 , n_node+2 , graph , qSet , @distance )
for i=path
    Qset_path = qSet(i)
end
movie = make_movie(Qset)

